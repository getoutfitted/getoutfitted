<template name='updateOrder'>
  {{#if Template.subscriptionsReady}}
    {{#with order}}
      {{> orderEditHeader}}
      <div class='container-fluid'>
        <div class='row'>
          <div class="col-xs-12 col-md-8">
            <div class="reservation-details order-items">
              <table class='table table-responsive table-condensed table-hover'>
                <thead>
                  <tr>
                    <th>Action</th>
                    <th>Title</th>
                    <th>Color</th>
                    <th>Size</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  {{#each bundle in bundles}}
                    <tr class="bundle-title edit-outfit">
                      <td>{{#if addingItems bundle._id}}
                        <button class='btn btn-danger btn-sm cancel-add-new-item' data-order-id="{{_id}}" data-bundle-id="{{bundle._id}}">Cancel</button>
                      {{else}}
                        <button class='btn btn-info btn-sm add-new-item' data-order-id="{{_id}}" data-bundle-id="{{bundle._id}}">Add Item to Outfit</button>
                      {{/if}}</td>
                      <td colspan="3"><strong>{{bundle.title}}</strong></td>
                      <td></td>
                    </tr>
                    {{#if addingItems bundle._id}}
                      <tr>
                        <td>
                        </td>
                        <td colspan="3">
                          <div class='row item-selector'>
                            {{> productSelector bundle=bundle this=this}}
                          </div>
                        </td>
                      </tr>
                    {{/if}}
                    {{#each item in itemsByBundle bundle}}
                      {{#if colorAndSize item}}
                        <tr>
                          <td><a class='btn btn-sm btn-warning disabled' href="{{pathFor 'updateOrderItem' orderId=this._id itemId=item._id}}">Edit this Item</a></td>
                          <td>{{item.title}}</td>
                          <td>{{color item}}</td>
                          <td>{{size item}}</td>
                          <td></td>
                        </tr>
                      {{else}}
                        <tr class='danger'>
                          <td><a class='btn btn-sm btn-danger' href="{{pathFor 'updateOrderItem' orderId=this._id itemId=item._id}}">Edit this Item</a></td>
                          <td>{{item.itemDescription}}</td>
                          <td>
                            <select id='color-selector-{{item._id}}' data-id='{{item._id}}' class='form-control color-selector'>
                              <option disabled selected> -- select a color -- </option>
                              {{#each possibleColor in colorOptions item}}
                                <option class="form-control" value="{{possibleColor}}">{{possibleColor}}</option>
                              {{/each}}
                            </select>
                          </td>
                          <td>
                            {{#if readyToSelectSize item}}
                              <select id='size-selector-{{item._id}}' data-id='{{item._id}}' class='form-control size-selector'>
                                <option disabled selected> -- select a size -- </option>
                                {{#each possibleSize in sizeOptions item}}
                                <option class='form-control' value={{possibleSize._id}}>{{possibleSize.size}}</option>
                                {{/each}}
                              </select>
                            {{/if}}
                          </td>
                          <td>
                            {{#if sizeAndColorSelected item}}
                              <a class='btn btn-success save-item' data-id='{{item._id}}' data-product-id='{{item.productId}}' href='#'>Save</a>
                            {{/if}}
                          </td>
                        </tr>
                      {{/if}}
                    {{/each}}
                    <tr>&nbsp;</tr>
                    <tr>&nbsp;</tr>
                  {{/each}}
                  <tr>
                    <td>
                      {{#if addingItems _id}}
                        <button class='btn btn-danger btn-sm cancel-add-new-item' data-order-id="{{_id}}">Cancel</button>
                      {{else}}
                        <button class='btn btn-info btn-sm add-new-item' data-order-id="{{_id}}">Add Item to Order</button>
                      {{/if}}
                    </td>
                    <td colspan="3">
                      <div class='row item-selector'>
                      {{#if addingItems _id}}
                        {{> productSelector}}
                      {{/if}}
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="col-xs-12 col-md-4">
            <h5><strong>Notes</strong></h5>
            {{> backpackOrderUserNotes}}
            {{> backpackOrderNoteForm}}
            <hr>
            {{> updateCustomerDetails}}
            <hr>
            {{> cancelOrder}}
          </div>
        </div>
        <hr>
      </div>
    {{/with}}
  {{/if}}
</template>

<template name="orderEditHeader">
  <section class="order-header">
    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-12">
          <h1 class="pull-left order-number">
            <a href="{{pathFor 'advancedFulfillment'}}">Orders</a> /
            <a href="{{pathFor 'orderDetails' _id=_id}}">{{displayOrderNumber this}}</a> / Edit
          </h1>
          <h2 class='pull-right text-right order-status'>
          Ship By:
            {{#if pastDate this.advancedFulfillment.shipmentDate}}
              <span class='text-danger'><strong>Today</strong></span> [{{formattedDate advancedFulfillment.shipmentDate}}]
            {{else}}
              {{formattedDate advancedFulfillment.shipmentDate}}
            {{/if}}
          </h2>
        </div>
      </div>
    </div>
  </section>
</template>

<template name='updateCustomerDetails'>
{{#if Template.subscriptionsReady}}
  <h5><strong>Shipping Address</strong></h5>
  <form class="updateShippingAddress" id="updateShippingAddressForm">
    <div class="form-group row">
      <div class="col-xs-12">
        <input type="text" class="form-control" name="shippingName" id="shippingName" placeholder="shippingName" value={{address "fullName"}}>
      </div>
      <div class="col-xs-12">
        <input type="text" class="form-control" name="company" id="company" placeholder="Company" value={{address "company"}}>
      </div>
      <div class="col-xs-12">
        <input type="text" class="form-control" name="shippingAddress1" id="shippingAddress1" placeholder="Address1" value={{address "address1"}}>
      </div>
      <div class="col-xs-12">
        <input type="text" class="form-control" name="shippingAddress2" id="shippingAddress2" placeholder="Address 2" value={{address "address2"}}>
      </div>
      <div class="col-xs-4">
        <input type="text" class="form-control" name="shippingCity" id="shippingCity" placeholder="City" value={{address "city"}} disabled>
      </div>
      <div class="col-xs-4">
        <input type="text" maxlength="2" class="form-control" name="shippingRegion" id="shippingRegion" placeholder="State" value={{address "region"}} disabled>
      </div>
      <div class="col-xs-4">
        <input type="text" class="form-control" name="shippingPostal" id="shippingPostal" placeholder="Postal Code" value={{address "postal"}} disabled>
      </div>
    </div>
    <button type="submit" class="btn btn-info btn-block">Update Shipping Address</button>
  </form>
  <hr>
  <h5><strong>Customer Contact Information</strong></h5>
  <form class="updateContactInformation" id="updateContactInformationForm">
    <div class="form-group row">
      <div class="col-xs-12">
        <input type="text" class="form-control" name="contactPhone" id="contactPhone" placeholder="Phone Number" value={{address "phone"}}>
      </div>
      <div class="col-xs-12">
        <input type="text" class="form-control" name="contactEmail" id="contactEmail" placeholder="Email Address" value={{email}}>
      </div>
    </div>
    <button type="submit" class="btn btn-info btn-block">Update Contact Info</button>
  </form>
  <hr>
  {{> updateCustomerDates}}
{{/if}}
</template>

<template name='updateCustomerDates'>
  <div class="form-group row">
    <p><strong>Update Reservation Dates</strong></p>
    <small>Temporarily disabled for new site launch</small>
    <div class='picker' id='{{_id}}'>
      <div class='input-daterange input-group' id='datepicker'>
        <input type='text' class='form-control' name='start' placeholder="First Ski Day" value={{formatInputDate startTime}} disabled/>
        <span class='input-group-addon'>to</span>
        <input type='text' class='form-control' name='end' placeholder="Last Ski Day" value={{formatInputDate endTime}} disabled/>
      </div>
    </div>
  </div>
  <button class='btn btn-success btn-block update-rental-dates' disabled>Update Reservation Dates</button>
</template>

<template name="cancelOrder">
  <button class='btn btn-danger btn-block confirm-to-cancel'>Cancel Order {{{displayOrderNumber this}}}</button>
  {{#if cancelOrder}}
    <p>I <strong>{{userName}}</strong>, certifiy that {{{displayOrderNumber this}}} should be cancelled. By cancelling this order, the order will not be viewed by anyone else and will not be fulfilled to the customer. I have also updated this order in Shopify (if applicable) to reflect the cancelled state.</p>
    <p><a class='btn btn-danger cancel-order'>I {{userName}}, confirm the cancelling of {{{displayOrderNumber this}}}</a></p>
  {{/if}}
</template>
